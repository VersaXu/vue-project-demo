<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="UTF-8">
    <link rel="icon" href="/Turtle-Soup/favicon.ico">
    <meta name="viewport" content="width=device-width initial-scale=1.0">
    <title>海龟汤问答游戏</title>
    <script type="module" crossorigin src="/Turtle-Soup/assets/index-DFyfGeut.js"></script>
    <link rel="stylesheet" crossorigin href="/Turtle-Soup/assets/index-C1wLpbzg.css">
    <script>
      // 在加载应用前注入API地址
      window.TURTLE_SOUP_API_URL = "https://turtle-soup-backend-hsry.vercel.app/api";
      
      // 修复API地址和游戏结束提示
      document.addEventListener('DOMContentLoaded', function() {
        // 创建一个全局变量供应用使用
        window.__TURTLE_SOUP_CONFIG__ = {
          apiBaseUrl: window.TURTLE_SOUP_API_URL
        };
        
        // 尝试替换已加载脚本中的API地址
        try {
          // 监听网络请求，拦截并修改API地址
          const originalFetch = window.fetch;
          window.fetch = function(url, options) {
            if (typeof url === 'string' && url.includes('turtle-soup-backend.vercel.app')) {
              url = url.replace('turtle-soup-backend.vercel.app', 'turtle-soup-backend-hsry.vercel.app');
            }
            return originalFetch.call(this, url, options);
          };
          
          // 同样拦截XMLHttpRequest
          const originalOpen = XMLHttpRequest.prototype.open;
          XMLHttpRequest.prototype.open = function(method, url, ...rest) {
            if (typeof url === 'string' && url.includes('turtle-soup-backend.vercel.app')) {
              url = url.replace('turtle-soup-backend.vercel.app', 'turtle-soup-backend-hsry.vercel.app');
            }
            return originalOpen.call(this, method, url, ...rest);
          };
          
          // 修复游戏结束时显示"提示：undefined"的问题
          const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
              if (mutation.addedNodes.length) {
                mutation.addedNodes.forEach(function(node) {
                  // 检查新添加的DOM节点
                  if (node.nodeType === 1) { // 元素节点
                    // 查找包含"提示：undefined"的元素
                    const messages = node.querySelectorAll('.message-text');
                    messages.forEach(function(message) {
                      if (message.innerHTML && message.innerHTML.includes('提示：undefined')) {
                        // 替换"提示：undefined"为空字符串
                        message.innerHTML = message.innerHTML.replace(/提示：undefined/, '');
                      }
                    });
                  }
                });
              }
            });
          });
          
          // 开始观察DOM变化
          observer.observe(document.body, { childList: true, subtree: true });
          
          console.log('API地址已更新为:', window.TURTLE_SOUP_API_URL);
        } catch (e) {
          console.error('修复API地址时出错:', e);
        }
      });
    </script>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
